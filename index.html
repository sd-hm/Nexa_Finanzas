<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kallpa Finanzas - Servicios Contables</title>
    <meta name="description" content="Kallpa Finanzas brinda asesor√≠a y servicios contables, financieros y empresariales en Arequipa.">
    <meta name="keywords" content="Kallpa Finanzas, asesor√≠a contable, servicios financieros, Arequipa, empresa">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    
    <style>
        .page-section {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .page-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .nav-link {
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            color: #2563eb;
        }

        .nav-link.active {
            color: #2563eb;
            font-weight: 600;
        }
        #header {
            margin-top: 50px; /* altura del top bar */
        }
    </style>
    <script>
        function handleFormSubmit(event) {
                if (event) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                
                const form = document.getElementById('contactForm');
                const button = document.querySelector('#contactForm button[type="button"]');
                
                if (!button) {
                    console.error('No se encontr√≥ el bot√≥n');
                    return false;
                }
                
                const originalHTML = button.innerHTML;
                
                button.innerHTML = '<i class="fas fa-check-circle"></i><span class="ml-2">¬°Mensaje Enviado!</span>';
                button.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                button.disabled = true;
                
                alert('¬°Gracias por contactarnos! Te responderemos pronto.');
                
                if (form) {
                    form.reset();
                }
                button.innerHTML = originalHTML;
                button.style.background = '';
                button.disabled = false;
                
                return false;
            }
    </script>
</head>
<body class="min-h-screen bg-gray-50 overflow-x-hidden">
    
    <header id="header" class="bg-white shadow-md sticky top-0 z-50">
        <!-- Header ser√° cargado aqu√≠ -->
    </header>

    <main>
        <!-- Inicio Section -->
        <section id="inicio" class="page-section active">
            <div class="container mx-auto px-4 py-16">
                <div class="text-center">
                    <div class="animate-pulse">Cargando contenido...</div>
                </div>
            </div>
        </section>

        <!-- Nosotros Section -->
        <section id="nosotros" class="page-section">
            <div class="container mx-auto px-4 py-16">
                <div class="text-center">
                    <div class="animate-pulse">Cargando contenido...</div>
                </div>
            </div>
        </section>

        <!-- Constituci√≥n Section -->
        <section id="constitucion" class="page-section">
            <div class="container mx-auto px-4 py-16">
                <div class="text-center">
                    <div class="animate-pulse">Cargando contenido...</div>
                </div>
            </div>
        </section>

        <!-- Servicio Contable Section -->
        <section id="servicio-contable" class="page-section">
            <div class="container mx-auto px-4 py-16">
                <div class="text-center">
                    <div class="animate-pulse">Cargando contenido...</div>
                </div>
            </div>
        </section>

        <!-- Facturaci√≥n Electr√≥nica Section -->
        <section id="facturacion" class="page-section">
            <div class="container mx-auto px-4 py-16">
                <div class="text-center">
                    <div class="animate-pulse">Cargando contenido...</div>
                </div>
            </div>
        </section>

        <!-- Minutas Section -->
        <section id="minutas" class="page-section">
            <div class="container mx-auto px-4 py-16">
                <div class="text-center">
                    <div class="animate-pulse">Cargando contenido...</div>
                </div>
            </div>
        </section>

        <!-- Contacto Section -->
        <section id="educacion" class="page-section">
            <div class="container mx-auto px-4 py-16">
                <div class="text-center">
                    <div class="animate-pulse">Cargando contenido...</div>
                </div>
            </div>
        </section>

        <!-- Contacto Section -->
        <section id="contacto" class="page-section">
            <div class="container mx-auto px-4 py-16">
                <div class="text-center">
                    <div class="animate-pulse">Cargando contenido...</div>
                </div>
            </div>
        </section>
    </main>

    <!-- CHATBOT CONTAINER -->
<div id="chatbot-container">
    <!-- Bot√≥n flotante -->
<button id="chat-toggle" class="fixed bottom-6 right-6 bg-white border-4 border-[#00C9B7] rounded-full p-3 shadow-2xl hover:shadow-[#00C9B7]/30 transition-all duration-300 z-50 hover:scale-110 group">
    <!-- Icono del chat (imagen) -->
    <img id="chat-icon" 
         src="./assets/images/chatbotRecortado.png" 
         alt="Kallpa Bot" 
         class="w-15 h-10 object-contain group-hover:rotate-12 transition-transform" 
         onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%2300C9B7%22 stroke-width=%222%22%3E%3Cpath d=%22M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z%22/%3E%3C/svg%3E'" />
    
    <!-- Icono de cerrar (X) -->
    <svg id="close-icon" class="w-10 h-10 hidden text-[#00C9B7] group-hover:rotate-90 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path>
    </svg>
    
    <!-- Badge de IA -->
    <span class="absolute -top-1 -right-1 bg-gradient-to-r from-[#00C9B7] to-[#009688] text-white text-[10px] font-bold rounded-full w-6 h-6 flex items-center justify-center shadow-lg">
        IA
    </span>
</button>

    <!-- Ventana del chat -->
    <div id="chat-window" class="fixed bottom-24 right-6 w-96 max-w-[calc(100vw-3rem)] h-[600px] max-h-[calc(100vh-8rem)] bg-white rounded-2xl shadow-2xl z-50 hidden flex-col overflow-hidden border-2 border-[#00C9B7]/20 animate-slide-up">
        <!-- ‚ú® HEADER SIMPLE Y LIMPIO ‚ú® -->
        <div class="bg-gradient-to-r from-[#00C9B7] to-[#009688] text-white p-5">
            <div class="flex items-center gap-4">
                
                <!-- Logo -->
                <div class="w-20 h-14 bg-white rounded-xl flex items-center justify-center shadow-lg p-2">
                    <img src="./assets/images/chatbotRecortado.png" 
                         alt="Kallpa Logo" 
                         class="w-full h-full object-contain" 
                         onerror="this.parentElement.innerHTML='<span class=\'text-2xl\'>ü§ñ</span>'" />
                </div>
                
                <!-- Texto -->
                <div class="flex-1">
                    <p class="text-md text-white/90 flex items-center gap-1.5">
                        <span class="w-2 h-2 bg-green-400 rounded-full"></span>
                        Asistente IA en l√≠nea
                    </p>
                </div>
                

            </div>
        </div>

        <!-- Mensajes -->
        <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gradient-to-b from-gray-50 to-white">
            <!-- Mensaje de bienvenida -->
            <div class="flex gap-2 animate-fade-in">
                <div class="w-10 h-10 bg-gradient-to-br from-[#00C9B7] to-[#009688] rounded-full flex items-center justify-center flex-shrink-0 shadow-lg">
                    <span class="text-white text-sm font-bold">ü§ñ</span>
                </div>
                <div class="bg-white rounded-2xl rounded-tl-none p-4 shadow-lg max-w-[85%] border border-gray-100">
                    <p class="text-gray-800 text-sm leading-relaxed">
                        ¬°Hola! üëã Soy <strong class="text-[#00C9B7]">Kallpa</strong>, tu asistente.
                    </p>
                    <div class="mt-3 p-3 bg-gradient-to-r from-[#00C9B7]/5 to-[#009688]/5 rounded-xl">
                        <p class="text-xs font-semibold text-[#1B3A5F] mb-2">üìö Puedo ayudarte con:</p>
                        <div class="space-y-1">
                            <p class="text-xs text-gray-700 flex items-center gap-2">
                                <span class="text-[#00C9B7]">üí∞</span> Educaci√≥n financiera
                            </p>
                            <p class="text-xs text-gray-700 flex items-center gap-2">
                                <span class="text-[#00C9B7]">üè¢</span> Constituci√≥n de empresas
                            </p>
                        </div>
                    </div>
                    <p class="text-xs text-gray-600 mt-3 italic">
                        ¬øEn qu√© puedo ayudarte hoy? üòä
                    </p>
                </div>
            </div>
        </div>

        <!-- Input -->
        <div class="p-4 bg-white border-t-2 border-gray-100">
            <div class="flex gap-2">
                <input 
                    type="text" 
                    id="chat-input" 
                    placeholder="Escribe tu pregunta aqu√≠..." 
                    class="flex-1 border-2 border-gray-200 rounded-full px-4 py-3 focus:outline-none focus:ring-2 focus:ring-[#00C9B7] focus:border-transparent text-sm placeholder-gray-400 transition-all"
                    maxlength="500"
                >
                <button id="send-button" class="bg-gradient-to-r from-[#00C9B7] to-[#009688] text-white rounded-full p-3 hover:scale-105 transition-transform disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 shadow-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                    </svg>
                </button>
            </div>
            <div class="flex items-center justify-between mt-2 px-2">
                <p class="text-xs text-gray-400" id="char-count">0/500</p>
            </div>
        </div>
    </div>
</div>

<!-- Estilos adicionales CSS -->
<style>
    @keyframes slide-up {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fade-in {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes bounce-slow {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    .animate-slide-up {
        animation: slide-up 0.3s ease-out;
    }

    .animate-fade-in {
        animation: fade-in 0.5s ease-out;
    }

    .animate-bounce-slow {
        animation: bounce-slow 3s ease-in-out infinite;
    }

    /* Scrollbar personalizado */
    #chat-messages::-webkit-scrollbar {
        width: 6px;
    }

    #chat-messages::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    #chat-messages::-webkit-scrollbar-thumb {
        background: #00C9B7;
        border-radius: 10px;
    }

    #chat-messages::-webkit-scrollbar-thumb:hover {
        background: #009688;
    }

    /* Responsive */
    @media (max-width: 640px) {
        #chat-window {
            right: 1rem;
            left: 1rem;
            width: auto;
            bottom: 6rem;
        }
    }
</style>


    <footer id="footer" class="bg-gray-800 text-white"></footer>

    <script>
    class NavigationManager {
        constructor() {
            this.currentPage = 'inicio';
            this.pages = ['inicio', 'nosotros', 'constitucion', 'contacto', 'educacion'];
            this.mobileMenuOpen = false;
            this.init();
        }

        

        async init() {
            await this.loadHeader();
            
            // Cargar p√°gina inicial seg√∫n URL o hash
            const initialPage = this.getPageFromURL();
            await this.navigateToPage(initialPage);
            
            this.setupNavigation();
            this.setupMobileMenu();
            this.handleBrowserNavigation();
        }

        getPageFromURL() {
            const hash = window.location.hash.slice(1);
            return this.pages.includes(hash) ? hash : 'inicio';
        }

        async loadHeader() {
            const header = document.getElementById('header');
            try {
                const response = await fetch('components/header.html');
                if (response.ok) {
                    header.innerHTML = await response.text();
                    return;
                }
            } catch (error) {
                console.log('Cargando header por defecto');
            }
            
            header.innerHTML = `
                <!-- Div superior que se oculta al hacer scroll -->
                <div id="top-info-bar" class="hidden lg:block h-[50px] w-full bg-white fixed top-0 left-0 z-50 shadow-sm"
                    style="transition: transform 0.3s ease-in-out;">
                    <div class="flex items-center justify-between h-full px-[40px] text-[#656565] text-md">
                        <!-- Lado izquierdo -->
                        <div class="flex items-center space-x-6">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-headset"></i>
                                <span>Habla con un asesor</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-phone"></i>
                                <span>+51 962 818 648</span>
                            </div>
                        </div>
                        
                        <div class="flex items-center space-x-2 pr-[130px]">
                            <i class="fas fa-clock"></i>
                            <span>HORARIO: LUNES A VIERNES 8:30 - 17:30 / S√ÅBADOS 9:00 - 13:00</span>
                        </div>
                        
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-5">
                                <a href="#" class="hover:opacity-80"><i class="fab fa-tiktok text-lg"></i></a>
                                <a href="#" class="hover:opacity-80"><i class="fab fa-facebook text-lg"></i></a>
                                <a href="#" class="hover:opacity-80"><i class="fab fa-youtube text-lg"></i></a>
                                <a href="#" class="hover:opacity-80"><i class="fab fa-instagram text-lg"></i></a>
                            </div>
                        </div>
                    </div>
                </div>    

                <nav class="bg-white shadow-md">
    <div class="container mx-auto px-4">
        <div class="flex justify-between items-center py-2 px-6">
            <!-- Logo -->
            <div class="flex items-center">
                <img src="assets/images/imagen.png" class="w-[90px] h-[70px] rounded-full object-cover">
            </div>

            <!-- Desktop Menu -->
            <div class="hidden md:flex items-center space-x-12">
                <a href="#inicio" class="text-md nav-link text-gray-700 hover:text-blue-600" data-page="inicio">Inicio</a>
                <a href="#nosotros" class="text-md nav-link text-gray-700 hover:text-blue-600" data-page="nosotros">Nosotros</a>
                <a href="#constitucion" class="text-md nav-link text-gray-700 hover:text-blue-600" data-page="constitucion">Constituci√≥n de Empresas</a>
                <a href="#educacion" class="text-md nav-link text-gray-700 hover:text-blue-600" data-page="educacion">Educacion Financiera</a>
                <a href="#contacto" class="text-md nav-link text-gray-700 hover:text-blue-600" data-page="contacto">Contacto</a>
                
                <!-- Bot√≥n WhatsApp en el navbar -->
                <a 
                    href="https://wa.me/51962818648" 
                    target="_blank" 
                    class="group relative inline-flex items-center gap-2 bg-gradient-to-r from-[#00C9B7] to-[#009688] hover:from-[#009688] hover:to-[#00C9B7] text-white font-semibold py-3 px-6 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 overflow-hidden"
                >
                    <span class="absolute inset-0 bg-white/20 transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"></span>
                    <i class="fab fa-whatsapp text-xl relative z-10"></i>
                    <span class="relative z-10 text-sm">Habla con un asesor</span>
                </a>
            </div>

            <!-- Mobile Menu Button -->
            <button id="mobile-menu-btn" class="md:hidden text-gray-700 focus:outline-none">
                <i class="fas fa-bars text-2xl"></i>
            </button>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden pb-4">
            <div class="flex flex-col space-y-3">
                <a href="#inicio" class="nav-link text-gray-700 hover:text-blue-600 py-2" data-page="inicio">Inicio</a>
                <a href="#nosotros" class="nav-link text-gray-700 hover:text-blue-600 py-2" data-page="nosotros">Nosotros</a>
                <a href="#constitucion" class="nav-link text-gray-700 hover:text-blue-600 py-2" data-page="constitucion">Constituci√≥n de Empresas</a>
                <a href="#educacion" class="nav-link text-gray-700 hover:text-blue-600 py-2" data-page="educacion">Educacion Financiera</a>
                <a href="#contacto" class="nav-link text-gray-700 hover:text-blue-600 py-2" data-page="contacto">Contacto</a>
                
                <!-- Bot√≥n WhatsApp en mobile menu -->
                <a 
                    href="https://wa.me/51962818648" 
                    target="_blank" 
                    class="group relative inline-flex items-center justify-center gap-2 bg-gradient-to-r from-[#00C9B7] to-[#009688] hover:from-[#009688] hover:to-[#00C9B7] text-white font-semibold py-3 px-6 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 overflow-hidden mt-4"
                >
                    <span class="absolute inset-0 bg-white/20 transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"></span>
                    <i class="fab fa-whatsapp text-xl relative z-10"></i>
                    <span class="relative z-10 text-sm">Habla con un asesor</span>
                </a>
            </div>
        </div>
    </div>
</nav>
                
            `;
            this.initTopBarScroll();
        }

        initTopBarScroll() {
            const topBar = document.getElementById('top-info-bar');
            if (!topBar) return;

            window.addEventListener('scroll', () => {
                if (window.scrollY === 0) {
                    // Mostrar solo cuando est√° en el inicio total
                    topBar.style.transform = "translateY(0)";
                } else {
                    // Ocultar al hacer cualquier scroll
                    topBar.style.transform = "translateY(-100%)";
                }
            });
        }
        


        async loadPageContent(page) {
            const section = document.getElementById(page);
            
            try {
                const response = await fetch(`pages/${page}.html`);
                if (!response.ok) throw new Error('P√°gina no encontrada');
                const html = await response.text();
                section.innerHTML = html;
            } catch (error) {
                console.error(`Error al cargar ${page}:`, error);
                section.innerHTML = `
                    <div class="container mx-auto px-4 py-16">
                        <div class="max-w-2xl mx-auto text-center">
                            <div class="bg-red-50 border border-red-200 rounded-lg p-8">
                                <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
                                <h2 class="text-2xl font-bold text-red-700 mb-2">Error al cargar la p√°gina</h2>
                                <p class="text-red-600">No se pudo cargar el contenido de "${page}".</p>
                                <p class="text-sm text-red-500 mt-2">${error.message}</p>
                                <button onclick="location.reload()" class="mt-4 bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">
                                    Recargar p√°gina
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        setupNavigation() {
            document.addEventListener('click', async (e) => {
                const link = e.target.closest('.nav-link');
                if (!link) return;

                e.preventDefault();
                const targetPage = link.dataset.page;
                await this.navigateToPage(targetPage);
                
                // Cerrar men√∫ m√≥vil si est√° abierto
                if (this.mobileMenuOpen) {
                    this.toggleMobileMenu();
                }
            });
        }

        async navigateToPage(page) {
            if (!this.pages.includes(page)) page = 'inicio';

            // Ocultar todas las secciones
            document.querySelectorAll('.page-section').forEach(sec => sec.classList.remove('active'));
            
            // Mostrar secci√≥n seleccionada
            const section = document.getElementById(page);
            section.classList.add('active');

            // Cargar contenido si est√° vac√≠o o tiene el placeholder
            if (section.querySelector('.animate-pulse')) {
                await this.loadPageContent(page);
            }

            // Actualizar enlaces activos
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.page === page) {
                    link.classList.add('active');
                }
            });

            // Actualizar URL sin recargar
            history.pushState({ page }, '', `#${page}`);
            
            this.currentPage = page;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        setupMobileMenu() {
            const menuBtn = document.getElementById('mobile-menu-btn');
            if (menuBtn) {
                menuBtn.addEventListener('click', () => this.toggleMobileMenu());
            }
        }

        toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const btn = document.getElementById('mobile-menu-btn');
            if (menu) {
                menu.classList.toggle('hidden');
                this.mobileMenuOpen = !this.mobileMenuOpen;
                
                // Cambiar icono
                const icon = btn.querySelector('i');
                if (this.mobileMenuOpen) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            }
        }

        handleBrowserNavigation() {
            window.addEventListener('popstate', (e) => {
                const page = e.state?.page || this.getPageFromURL();
                this.navigateToPage(page);
            });
        }
    }

    // Inicializar cuando el DOM est√© listo
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => new NavigationManager());
    } else {
        new NavigationManager();
    }


    function toggleFAQ(id) {
        const element = document.getElementById(id);
        const icon = document.getElementById('icon-' + id);
        
        if (element.classList.contains('hidden')) {
            element.classList.remove('hidden');
            icon.classList.add('rotate-180');
        } else {
            element.classList.add('hidden');
            icon.classList.remove('rotate-180');
        }
    }


    // ========================================
// KALLPA-BOT - Script Corregido para Hugging Face
// ========================================

// ‚ö†Ô∏è CONFIGURACI√ìN - REEMPLAZA CON TU SPACE
const HF_SPACE = 'sdhm01-test';


class KallpaAIChat {
    constructor() {
        this.isTyping = false;
        this.conversationHistory = [];
        this.setupEventListeners();
        this.updateCharCount();
    }

    setupEventListeners() {
        const chatToggle = document.getElementById('chat-toggle');
        const chatWindow = document.getElementById('chat-window');
        const chatIcon = document.getElementById('chat-icon');
        const closeIcon = document.getElementById('close-icon');
        const sendButton = document.getElementById('send-button');
        const chatInput = document.getElementById('chat-input');

        chatToggle.addEventListener('click', () => {
            const isHidden = chatWindow.classList.contains('hidden');
            chatWindow.classList.toggle('hidden', !isHidden);
            chatWindow.classList.toggle('flex', isHidden);
            chatIcon.classList.toggle('hidden', isHidden);
            closeIcon.classList.toggle('hidden', !isHidden);
            
            if (isHidden) {
                chatInput.focus();
                chatToggle.classList.remove('animate-bounce-slow');
            } else {
                chatToggle.classList.add('animate-bounce-slow');
            }
        });

        sendButton.addEventListener('click', () => this.sendMessage());

        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !this.isTyping) {
                this.sendMessage();
            }
        });

        chatInput.addEventListener('input', () => {
            sendButton.disabled = chatInput.value.trim() === '' || this.isTyping;
            this.updateCharCount();
        });
    }

    updateCharCount() {
        const input = document.getElementById('chat-input');
        const counter = document.getElementById('char-count');
        if (counter && input) {
            counter.textContent = `${input.value.length}/500`;
        }
    }

    async sendMessage() {
        const input = document.getElementById('chat-input');
        const message = input.value.trim();
        
        if (!message || this.isTyping) return;

        input.value = '';
        this.updateCharCount();
        document.getElementById('send-button').disabled = true;
        
        this.addMessage(message, 'user');
        this.showTypingIndicator();

        try {
            const response = await this.callAI(message);
            this.hideTypingIndicator();
            this.addMessage(response, 'assistant');
            
        } catch (error) {
            console.error('Error:', error);
            this.hideTypingIndicator();
            this.addMessage(this.getFallbackResponse(message), 'assistant');
        }

        document.getElementById('send-button').disabled = false;
        input.focus();
    }

    async callAI(messageText) {
    try {
        const response = await fetch("https://sdhm01-test.hf.space/api/chat", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ message: messageText })
        });

        if (!response.ok) {
            throw new Error("HTTP Error: " + response.status);
        }

        const result = await response.json();
        // üî• Cambia esto:
        return result.response || result.reply || "No se recibi√≥ respuesta";
    } catch (e) {
        console.error("‚ùå Error:", e);
        throw e;
    }
}

    async callGradioClient(message) {
        console.log('üì° M√©todo 1: Cliente Gradio...');
        
        // Endpoint correcto para Gradio 4+
        const url = `https://${HF_SPACE.replace('/', '-')}.hf.space/call/chat`;
        
        // Paso 1: Iniciar la llamada
        const initResponse = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                data: [message, this.conversationHistory]
            })
        });

        if (!initResponse.ok) {
            throw new Error(`HTTP ${initResponse.status}: ${initResponse.statusText}`);
        }

        const initData = await initResponse.json();
        const eventId = initData.event_id;

        if (!eventId) {
            throw new Error('No se recibi√≥ event_id');
        }

        // Paso 2: Obtener el resultado usando SSE
        const resultUrl = `https://${HF_SPACE.replace('/', '-')}.hf.space/call/chat/${eventId}`;
        
        return new Promise((resolve, reject) => {
            const eventSource = new EventSource(resultUrl);
            let fullResponse = '';
            
            eventSource.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    
                    if (data.msg === 'process_generating' || data.msg === 'process_completed') {
                        if (data.output && data.output.data && data.output.data[0]) {
                            fullResponse = data.output.data[0];
                        }
                    }
                    
                    if (data.msg === 'process_completed') {
                        eventSource.close();
                        console.log('‚úÖ Respuesta recibida');
                        resolve(fullResponse || 'Respuesta vac√≠a recibida');
                    }
                    
                    if (data.msg === 'error') {
                        eventSource.close();
                        reject(new Error(data.error || 'Error desconocido'));
                    }
                } catch (err) {
                    console.error('Error parseando evento:', err);
                }
            };

            eventSource.onerror = (error) => {
                eventSource.close();
                reject(new Error('Error en conexi√≥n SSE'));
            };

            // Timeout de 30 segundos
            setTimeout(() => {
                eventSource.close();
                if (fullResponse) {
                    resolve(fullResponse);
                } else {
                    reject(new Error('Timeout esperando respuesta'));
                }
            }, 30000);
        });
    }

    async callGradioIframe(message) {
        console.log('üì° M√©todo 2: API alternativa...');
        
        // Intenta con el endpoint de join
        const url = `https://${HF_SPACE.replace('/', '-')}.hf.space/queue/join`;
        
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                data: [message, this.conversationHistory],
                fn_index: 0,
                session_hash: this.generateSessionHash()
            })
        });

        if (!response.ok) {
            throw new Error(`HTTP ${response.status}`);
        }

        const data = await response.json();
        
        if (data && data.data && data.data[0]) {
            console.log('‚úÖ M√©todo 2 exitoso');
            return data.data[0];
        }

        throw new Error('Respuesta inv√°lida del servidor');
    }

    generateSessionHash() {
        return Math.random().toString(36).substring(2, 15);
    }

    addMessage(content, role) {
        const messagesDiv = document.getElementById('chat-messages');
        const messageDiv = document.createElement('div');
        messageDiv.className = 'animate-fade-in';
        
        if (role === 'user') {
            messageDiv.innerHTML = this.createUserMessage(content);
        } else {
            messageDiv.innerHTML = this.createAssistantMessage(content);
        }
        
        messagesDiv.appendChild(messageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    createUserMessage(content) {
        return `
            <div class="flex justify-end gap-2 mb-4">
                <div class="bg-gradient-to-r from-[#00C9B7] to-[#009688] text-white rounded-2xl rounded-tr-none p-4 shadow-lg max-w-[85%]">
                    <p class="text-sm leading-relaxed">${this.escapeHtml(content)}</p>
                </div>
                <div class="w-10 h-10 bg-gradient-to-r from-[#00C9B7] to-[#009688] rounded-full flex items-center justify-center flex-shrink-0 shadow-lg">
                    <span class="text-white text-sm font-bold">üë§</span>
                </div>
            </div>
        `;
    }

    createAssistantMessage(content) {
        const formattedContent = this.formatAIResponse(content);
        const messageId = 'msg-' + Date.now();
        
        return `
            <div class="flex gap-2 mb-4">
                <div class="w-10 h-10 bg-gradient-to-br from-[#00C9B7] to-[#009688] rounded-full flex items-center justify-center flex-shrink-0 shadow-lg">
                    <span class="text-white text-sm font-bold">ü§ñ</span>
                </div>
                <div class="bg-white rounded-2xl rounded-tl-none p-4 shadow-lg max-w-[85%] border border-gray-100">
                    <div class="text-gray-800 text-sm leading-relaxed prose prose-sm max-w-none" id="${messageId}">
                        ${formattedContent}
                    </div>
                    <div class="flex gap-3 mt-3 pt-2 border-t border-gray-100">
                        <button onclick="kallpaAI.copyToClipboard('${messageId}')" 
                                class="text-xs text-[#00C9B7] hover:text-[#009688] transition-colors flex items-center gap-1 hover:underline">
                            üìã Copiar
                        </button>
                        <button onclick="kallpaAI.suggestContact()" 
                                class="text-xs text-[#00C9B7] hover:text-[#009688] transition-colors flex items-center gap-1 hover:underline">
                            üìû Contactar
                        </button>
                    </div>
                </div>
            </div>
        `;
    }

    formatAIResponse(text) {
        let formatted = text
            .replace(/\*\*(.*?)\*\*/g, '<strong class="text-[#1B3A5F] font-semibold">$1</strong>')
            .replace(/\*(.*?)\*/g, '<em class="text-gray-700">$1</em>')
            .replace(/\n\n/g, '</p><p class="mt-2">')
            .replace(/\n/g, '<br>');

        if (!formatted.startsWith('<p')) {
            formatted = '<p>' + formatted + '</p>';
        }

        formatted = formatted.replace(/^[-‚Ä¢]\s(.+)$/gm, '<li class="ml-4">$1</li>');
        formatted = formatted.replace(/(<li.*?<\/li>\s*)+/g, '<ul class="list-disc list-inside space-y-1 my-2">$&</ul>');

        return formatted;
    }

    showTypingIndicator() {
        this.isTyping = true;
        const messagesDiv = document.getElementById('chat-messages');
        const typingDiv = document.createElement('div');
        typingDiv.id = 'typing-indicator';
        typingDiv.innerHTML = `
            <div class="flex gap-2 mb-4">
                <div class="w-10 h-10 bg-gradient-to-br from-[#00C9B7] to-[#009688] rounded-full flex items-center justify-center flex-shrink-0 shadow-lg">
                    <span class="text-white text-sm font-bold">ü§ñ</span>
                </div>
                <div class="bg-white rounded-2xl rounded-tl-none p-4 shadow-lg border border-gray-100">
                    <div class="flex gap-1 items-center">
                        <div class="text-xs text-gray-500 mr-2 font-medium">Escribiendo</div>
                        <div class="w-2 h-2 bg-[#00C9B7] rounded-full animate-bounce"></div>
                        <div class="w-2 h-2 bg-[#00C9B7] rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                        <div class="w-2 h-2 bg-[#00C9B7] rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                    </div>
                </div>
            </div>
        `;
        messagesDiv.appendChild(typingDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    hideTypingIndicator() {
        this.isTyping = false;
        const indicator = document.getElementById('typing-indicator');
        if (indicator) indicator.remove();
    }

    getFallbackResponse(userMessage) {
        return `ü§ñ <strong>Conectando con el asistente IA...</strong>

<p class="mt-2">Estamos teniendo dificultades t√©cnicas temporales. Tu pregunta sobre: <em>"${this.escapeHtml(userMessage)}"</em></p>

<div class="mt-3 p-3 bg-gradient-to-r from-[#00C9B7]/10 to-[#009688]/10 rounded-lg">
    <p class="font-semibold text-[#1B3A5F] mb-2">üìû Contacto directo:</p>
    <p class="text-sm">‚Ä¢ <strong>WhatsApp</strong>: +51 962 818 648</p>
    <p class="text-sm">‚Ä¢ <strong>Horario</strong>: Lunes a Viernes 8:30-17:30</p>
</div>

<p class="mt-3 text-sm">¬°Nuestro equipo estar√° encantado de ayudarte! üí´</p>`;
    }

    copyToClipboard(messageId) {
        const element = document.getElementById(messageId);
        if (!element) return;
        
        const text = element.innerText;
        
        navigator.clipboard.writeText(text).then(() => {
            this.showNotification('‚úì Texto copiado');
        }).catch(err => {
            console.error('Error al copiar:', err);
            this.showNotification('‚úó Error al copiar');
        });
    }

    suggestContact() {
        this.showNotification('üìû Abriendo WhatsApp...');
        setTimeout(() => {
            window.open('https://wa.me/51962818648?text=Hola,%20vengo%20del%20chatbot', '_blank');
        }, 1000);
    }

    showNotification(message) {
        const notification = document.createElement('div');
        notification.className = 'fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-[#00C9B7] to-[#009688] text-white px-6 py-3 rounded-full shadow-2xl z-[60] animate-fade-in font-medium';
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.opacity = '0';
            notification.style.transform = 'translate(-50%, -10px)';
            notification.style.transition = 'all 0.3s ease-in';
            setTimeout(() => notification.remove(), 300);
        }, 2000);
    }

    escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
}

// Inicializar
let kallpaAI;
document.addEventListener('DOMContentLoaded', () => {
    console.log('ü§ñ Iniciando KALLPA-BOT...');
    kallpaAI = new KallpaAIChat();
    console.log('‚úÖ KALLPA-BOT listo');
});



    </script>

</body>


</html>